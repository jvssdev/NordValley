# enable powerlevel10k instant prompt, keep at the top of the file
# if [[ -r "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh" ]]; then
#   source "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh"
# fi

cache_dir="${XDG_CACHE_HOME:-$HOME/.cache}/zsh"
if [[ ! -d "$cache_dir" ]]; then
  mkdir -p "$cache_dir"
fi

# tab autocompletions
autoload -Uz compinit
zstyle ':completion:*' menu select
zmodload zsh/complist
_comp_options+=(globdots)
compinit -d $XDG_CACHE_HOME/zsh/zcompdump-$ZSH_VERSION

# use vim keys in tab complete menu
# bindkey -M menuselect 'h' vi-backward-char
# bindkey -M menuselect 'k' vi-up-line-or-history
# bindkey -M menuselect 'l' vi-forward-char
# bindkey -M menuselect 'j' vi-down-line-or-history
# bindkey -v '^?' backward-delete-char
#
# history
export HISTSIZE=100000
export SAVEHIST=20000
export HISTFILE="$HOME/.cache/zsh/history"
setopt hist_ignore_dups     # do not record an event that was just recorded again
setopt hist_ignore_all_dups # delete an old recorded event if a new event is a duplicate
setopt hist_ignore_space    # do not record an event starting with a space
setopt hist_save_no_dups    # do not write a duplicate event to the history file
setopt inc_append_history   # write to the history file immediately, not when the shell exits
setopt share_history        # share history between terminals

# change word selection to exclude slashes
autoload -U select-word-style
select-word-style bash

# fix vi plugin conflicting with fzf
export ZVM_INIT_MODE=sourcing
export PATH="/usr/lib64/qt6/bin:$PATH"

alias xh='hx'
alias ls='lsd'
alias cat='bat --paging=never'
#
# bindkey -v
# export KEYTIMEOUT=1
#
#
# # Change cursor shape for different vi modes.
# function zle-keymap-select {
#   if [[ ${KEYMAP} == vicmd ]] ||
#      [[ $1 = 'block' ]]; then
#     echo -ne '\e[2 q'
#   elif [[ ${KEYMAP} == main ]] ||
#        [[ ${KEYMAP} == viins ]] ||
#        [[ ${KEYMAP} = '' ]] ||
#        [[ $1 = 'beam' ]]; then
#     echo -ne '\e[6 q'
#   fi
# }
# zle -N zle-keymap-select
#
# # Use vim keys in tab complete menu:
# bindkey -M menuselect 'h' vi-backward-char
# bindkey -M menuselect 'j' vi-down-line-or-history
# bindkey -M menuselect 'k' vi-up-line-or-history
# bindkey -M menuselect 'l' vi-forward-char
# bindkey -M menuselect 'left' vi-backward-char
# bindkey -M menuselect 'down' vi-down-line-or-history
# bindkey -M menuselect 'up' vi-up-line-or-history
# bindkey -M menuselect 'right' vi-forward-char
# # Fix backspace bug when switching modes
# bindkey "^?" backward-delete-char
#
#
# zle-line-init() {
#     zle -K viins # initiate `vi insert` as keymap (can be removed if `bindkey -V` has been set elsewhere)
#     echo -ne "\e[6 q"
# }
#
#
# zle -N zle-line-init
# echo -ne '\e[6 q' # Use beam shape cursor on startup.
# precmd() { echo -ne '\e[6 q' ;} # Use beam shape cursor for each new prompt.

# basic plugin manager to automatically import zsh plugins
# script by mattmc3 from https://github.com/mattmc3/zsh_unplugged
# clone a plugin, identify its init file, source it, and add it to your fpath
function plugin-load {
	local repo plugdir initfile initfiles=()
	: ${ZPLUGINDIR:=${ZDOTDIR:-~/.config/zsh}/plugins}
	for repo in $@; do
		plugdir=$ZPLUGINDIR/${repo:t}
		initfile=$plugdir/${repo:t}.plugin.zsh
		if [[ ! -d $plugdir ]]; then
			echo "Cloning $repo..."
			git clone -q --depth 1 --recursive --shallow-submodules \
				https://github.com/$repo $plugdir
		fi
		if [[ ! -e $initfile ]]; then
			initfiles=($plugdir/*.{plugin.zsh,zsh-theme,zsh,sh}(N))
			(( $#initfiles )) || { echo >&2 "No init file '$repo'." && continue }
			ln -sf $initfiles[1] $initfile
		fi
		fpath+=$plugdir
		. $initfile
	done
}

# list of github repos of plugins
repos=(
	Multirious/zsh-helix-mode
	zsh-users/zsh-autosuggestions
	zdharma-continuum/fast-syntax-highlighting
)
export ZHM_STYLE_CURSOR_SELECT="fg=#2e3440,bg=#bf616a"     
export ZHM_STYLE_CURSOR_INSERT="fg=#2e3440,bg=#a3be8c"     
export ZHM_STYLE_OTHER_CURSOR_NORMAL="fg=#2e3440,bg=#81a1c1"  
export ZHM_STYLE_OTHER_CURSOR_SELECT="fg=#2e3440,bg=#b48ead"  
export ZHM_STYLE_OTHER_CURSOR_INSERT="fg=#2e3440,bg=#88c0d0"  
export ZHM_STYLE_SELECTION="fg=#eceff4,bg=#434c5e"

export ZHM_CURSOR_INSERT='\e[0m\e[6 q\e]12;#a3be8c\a'     
# export ZHM_CURSOR_SELECT='\e[0m\e[2 q\e]12;#bf616a\a'     
# export ZHM_CURSOR_NORMAL='\e[0m\e[2 q\e]12;#81a1c1\a'

plugin-load $repos

ZSH_AUTOSUGGEST_CLEAR_WIDGETS+=(
  zhm_history_prev
  zhm_history_next
  zhm_prompt_accept
  zhm_accept
  zhm_accept_or_insert_newline
)
ZSH_AUTOSUGGEST_ACCEPT_WIDGETS+=(
  zhm_move_right
  zhm_clear_selection_move_right
)
ZSH_AUTOSUGGEST_PARTIAL_ACCEPT_WIDGETS+=(
  zhm_move_next_word_start
  zhm_move_next_word_end
)

eval "$(fzf --zsh)"

zhm_wrap_widget fzf-completion zhm_fzf_completion
bindkey '^I' zhm_fzf_completion
    
export FZF_DEFAULT_OPTS=" \
--color=bg+:#3b4252,bg:#2e3440,spinner:#d8dee9,hl:#88c0d0 \
--color=fg:#d8dee9,header:#88c0d0,info:#81a1c1,pointer:#d8dee9 \
--color=marker:#a3be8c,fg+:#eceff4,prompt:#81a1c1,hl+:#8fbcbb"

eval "$(zoxide init zsh)"

#eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"
eval "$(starship init zsh)"
